<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/grid.css">
    <title>Names</title>
</head>

<body class="container">
    <section class="container">
        <div class="center logo">
            <img src="../images/LINGOUP.png" alt="">

        </div>

        <div class="center start">
            <button type="button" onclick="init()">Start</button>
        </div>

        <div class="center">
            <div class="webCam" id="webcam-container"></div>
            <div id="label-container"></div>
        </div>

        <div class="center">
            <div id="label-containerV"></div>
        </div>

    </section>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/@tensorflow-models/speech-commands@0.4.0/dist/speech-commands.min.js"></script>
    <script type="text/javascript">

        const URL = "https://teachablemachine.withgoogle.com/models/M84DSAFbh/";
        const URLV = "https://teachablemachine.withgoogle.com/models/AFHbI07t6/";

        let model, webcam, labelContainer, maxPredictions;

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";


            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            const flip = true;
            webcam = new tmImage.Webcam(300, 300, flip);
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);


            document.getElementById("webcam-container").appendChild(webcam.canvas);
            labelContainer = document.getElementById("label-container");
            
            for (let i = 0; i < maxPredictions; i++) {
                labelContainer.appendChild(document.createElement("div"));
            }
        }

        async function initVoice() {
                const recognizer = await createModel();
                const classLabels = recognizer.wordLabels();
                const labelContainerV = document.getElementById("label-containers");
                for (let i = 0; i < classLabels.length; i++) {
                    labelContainers.appendChild(document.createElement("div"));
                }

                recognizer.listen(result => {
                    const scores = result.scores;
                    for (let i = 0; i < classLabels.length; i++) {
                        const classPrediction = classLabels[i] + ": " + result.scores[i].toFixed(2);
                        labelContainers.childNodes[i].innerHTML = classPrediction;
                    }
                }, {
                    includeSpectrogram: true,
                    probabilityThreshold: 0.75,
                    invokeCallbackOnNoiseAndUnknown: true,
                    overlapFactor: 0.50
                });


            }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        async function predict() {

            let maxPrediction = 0;
            let name;

            const prediction = await model.predict(webcam.canvas);
            for (let prob of prediction) {
                if (prob.probability > maxPrediction) {
                    maxPrediction = prob.probability;
                    name = prob.className;
                }

                labelContainer.innerHTML = name;
            }
        }

        async function createModel() {
            const checkpointURL = URLv + "model.json";
            const metadataURLs = URLv + "metadata.json";

            const recognizer = speechCommands.create(
                "BROWSER_FFT",
                undefined,
                checkpointURL,
                metadataURLs);


            await recognizer.ensureModelLoaded();

            return recognizer;
        }

    </script>


</body>

</html>